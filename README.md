# Malware-Analysis---OlympicDestroyer(.exe)
A behavioral malware analysis of wiper family type malware

    Malware: 	OlympicDestroyer.exe
    Hash: 		cfdd16225e67471f5ef54cab9b3a5558


-Wiper malware family type

-Was created on 2018

-Aimed to destruct “PyeongChang Olympic 2018” opening ceremony held at South Korea 

-It’s a behavioral malware analysis


Prepare the environment for malware analysis
--------------------------------------------

Virtual environment with two operating systems on VM Ware

    - Windows 7 (32 bit)
    - REMnux 6.0 (Ubuntu 14.04 based Linux distribution) (for monitor networking point of view)

Isolate PCs from internet and from host PC

Create a separate subnetwork with new virtual network adapter 

Connect both (only) virtual machines to created subnetwork

Assign created network adapter to both VMs

Renew IP addresses and Note IPs

On Windows 7

    - ipconfig /release
    - ipconfig /renew

On REMnux

	- sudo dhclient –r eth0
	- sudo dhclient eth0 

Check Internet connectivity of both PC (Has to be disabled)

Check Virtual PCs connectivity (Has to be Succeeded)

Route the Windows traffic to REMnux PC

On Windows 7 

    - Set Default gateway and DNS as REMnux PC’s IP (using manual IP configuration)		
    - Set Proxy as localhost (& port 8080)

Accept all traffic from Windows PC 

On REMnux 

    - accept-all- ips
    - accept-all- ips start eth0 (to accept any IP from windows PC)
		
Create a fake internet environment
	
  On REMnux
  
    -Run fakedns (torun fake DNS service)
    -Run inetsim (to create network service simulation)

Download Malware sample
-----------------------
 
Can be downloaded from 

    Hybrid Analysis (https://www.hybrid-analysis.com)
    Virusbay 	(https://beta.virusbay.io)
    VirusTotal 	(https://www.virustotal.com)

Installed tools on windows 7
----------------------------

    Process Hacker
    Process Monitor
    peStudio
    Resource Hacker
    Signsrch
    CFF Explorer
    x32dbg
    HxD
    DB browser for SQLite
    Burp Suite
    IDA Demo

Work with tools
---------------

Continuously run Process Hacker to observe running processes

Set filter on Process Monitor to visualize display easier (Included filters: Operation is Process Create & Operation is Process Exit)

Use peStudio for Initial malware Analysis
	
    - 05 unknown resources
    - with High entropy value (probably packed & encrypted)
    - with Same first few bytes (probably they used same kind of key for encryption)

Use Resource Hacker to view resource content of the malware  
	
    - first few bytes header of resources are similar 

Signsrch

To identify signature and encryption algorithm used in the malware
		
    On Cmd
      :\> signsrch.exe
      :\> signsrch.exe -F ..\olympicDestroyer.exe

AES algorithms were used 

    NOTE: If we need, we can do reverse engineering analysis (if they use static key) by using the memory location
    Remove the Address space layout randomization (ASLR) from the sample malware using CFF Explorer
      Optional Header -> DllChracteristics -> click here -> uncheck DLL can move
      save the binary with new name (DON’T overwrite ) (Eg.OlympicDestroyer_NoAslr.exe) 	

X32dbg

    Open saved file with x32dbg (Debugger)
    Search memory location of AES Algorithm
    Do Reverse Engineering to analyze statistical values

START Analysis
--------------------

Malware Intro 
  
    -Obfuscated /Packed
    -Steal Browser stored credential 
    -Steal system credential
    -Then reform another binary (with credential)  

On REMnux 

    -Open wireshark to capture traffic
    -Ensure FakeDNS and Inetsim services are running

To view sring values in the malware 	

    strings -n 10 olympicdestroyer_NoAslr.exe
      (Many strings with “Pyeongchang2018.com\….”)
    strings -n 10 olympicdestroyer_NoAslr.exe | grep -i 2018
      (already hardcoded with some properties)

Clear Procmonitor screen

Run the malware file (By double click)

Observe the process hacker
	
    -Creates child processes

Observe on procmonitor
	
    Child processes
		-vfikl.exe, _gqu.exe (communicate back to the main processes with credential)
	
    Open tree view to get clear idea about all related processes
		-_gqu .exe
			Responsible for badnesses such
			-	Delete shadowed copies (Ransomeware like action before encrypt)
			-	Delete catalog (prevent any recovery)
			-	Edit Boot configuration ( Disable potential recovery when restart)
			-	Delete system
			-	Delete Security ( Prevent Forensics analysis on victim PC)

Open Temporary directory (%TMP%) to view running temporary processes.
---------------------------------------------------------------------

_wmp.exe

    -largest file size
    -Open with pestudio
    -05 resources similar to original malware resources
    -it’s a new reformed binary created with the credential found on the machine

_vgg.exe
	
    -Open with pestudio
    -PSEXESVC
      -executable application (Genuine process / service used to run on remote system or propagate around network)
    - blacklisted values in imports view 

-vfikl.exe

    -Open with pestudio
    -encrypted resources
    -High file ratio
    -High entropy

On REMnux

	-lot of DNS Requests
	-lot of traffic on wireshark

Analyze main processes with x32dbg
-----------------------------------

-wmp.exe

    Search for any interesting strings references
      - “select * from win32_ProcessStopTrace” (interfere)
      - “cmd.exe /c (ping 0.0.0.0 >null) && …….” (check, write & delete files)
      - “select ds_cn From ds_computer” (looking for network discovery, IP based on query. This request attempts to list all the systems within the current environment/directory)

    Go to “select * from win32_ProcessStopTrace” by double click on it
    Go “cmd.exe /c (ping 0.0.0.0 >null) && …….”
    Observe under CPU tab….

    Close debugger

-_gqu.exe
	
    Search for any interesting strings references
      - “ServicesActive”
      - “delete shadows /all /quiet”
      - “delete catalog -quiet”
      - “/set {default} bootstatuspolicy…..”
      - “windowsShutdown”

    -create some breakpoint and observe the value changes in debugger
      (Eg. [<&wNetOpenEnumw>] , [<&wNetEnumResourcew>])
			


References
----------

	https://blog.talosintelligence.com/2018/02/olympic-destroyer.html#more
	https://www.youtube.com/channel/UCND1KVdVt8A580SjdaS4cZg (channel)
	https://www.hybrid-analysis.com/sample/edb1ff2521fb4bf748111f92786d260d40407a2e8463dcd24bb09f908ee13eb9

